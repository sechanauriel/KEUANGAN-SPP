<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPP Management System - API Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        header h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        header p {
            color: #666;
            font-size: 1.1em;
        }

        .api-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .api-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .api-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .api-card h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .method-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: bold;
            color: white;
        }

        .method-get {
            background: #4CAF50;
        }

        .method-post {
            background: #2196F3;
        }

        .endpoint {
            background: #f5f5f5;
            padding: 10px;
            border-left: 4px solid #667eea;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            word-break: break-all;
            color: #333;
        }

        .description {
            color: #666;
            font-size: 0.95em;
            margin: 10px 0;
            line-height: 1.5;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            min-width: 100px;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .category {
            margin-bottom: 40px;
        }

        .category-title {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #667eea;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .category-title h2 {
            color: #667eea;
            font-size: 1.8em;
        }

        .response-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow-y: auto;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .modal-header h2 {
            color: #667eea;
        }

        .close-btn {
            font-size: 2em;
            cursor: pointer;
            color: #999;
            background: none;
            border: none;
            padding: 0;
        }

        .close-btn:hover {
            color: #333;
        }

        .response-content {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #333;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .status-success {
            color: #4CAF50;
            font-weight: bold;
        }

        .status-error {
            color: #f44336;
            font-weight: bold;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            color: #666;
            margin-top: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            color: #667eea;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .stat-card p {
            color: #666;
        }

        .input-group {
            margin: 15px 0;
        }

        .input-group label {
            display: block;
            color: #333;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }

        .success-text {
            background: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }

        .error-text {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéì SPP Management System</h1>
            <p>API Dashboard - MINGGU 11: Modul Keuangan</p>
        </header>

        <div class="stats" id="stats-container">
            <div class="stat-card">
                <h3 id="total-students">-</h3>
                <p>Total Mahasiswa</p>
            </div>
            <div class="stat-card">
                <h3 id="total-billed">-</h3>
                <p>Total Tagihan</p>
            </div>
            <div class="stat-card">
                <h3 id="total-paid">-</h3>
                <p>Total Terbayar</p>
            </div>
            <div class="stat-card">
                <h3 id="collection-rate">-</h3>
                <p>Collection Rate</p>
            </div>
        </div>

        <!-- STUDENT MANAGEMENT SECTION -->
        <div class="category">
            <div class="category-title">
                <h2>üë• STUDENT MANAGEMENT APIs</h2>
            </div>

            <div class="api-grid">
                <!-- Add Student -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-post">POST</span>
                        Tambah Mahasiswa Baru
                    </h3>
                    <div class="endpoint">/api/billing/student</div>
                    <div class="description">
                        Tambahkan mahasiswa baru ke sistem
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="toggleAddStudentForm()">üìù Form Input</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student')">üìã Copy</button>
                    </div>
                </div>

                <!-- Delete Student -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge" style="background: #e74c3c;">DELETE</span>
                        Hapus Mahasiswa
                    </h3>
                    <div class="endpoint">/api/billing/student/:id</div>
                    <div class="description">
                        Hapus data mahasiswa dari sistem
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="toggleDeleteStudentForm()">üóëÔ∏è Delete Form</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student/:id')">üìã Copy</button>
                    </div>
                </div>

                <!-- List Students -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Lihat Semua Mahasiswa
                    </h3>
                    <div class="endpoint">/api/billing/student</div>
                    <div class="description">
                        Dapatkan daftar lengkap semua mahasiswa
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="showModal('/api/billing/student')">‚ñ∂Ô∏è Test</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student')">üìã Copy</button>
                    </div>
                </div>

                <!-- Search Student -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Search Mahasiswa
                    </h3>
                    <div class="endpoint">/api/billing/student/search?q=query</div>
                    <div class="description">
                        Cari mahasiswa berdasarkan NIM atau Nama
                    </div>
                    <input type="text" id="search-student-query" placeholder="Masukkan NIM atau Nama..." style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testSearchStudent()">üîç Search</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student/search?q=')">üìã Copy</button>
                    </div>
                </div>

                <!-- Get Student Detail -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Detail Mahasiswa
                    </h3>
                    <div class="endpoint">/api/billing/student/:id</div>
                    <div class="description">
                        Dapatkan detail lengkap satu mahasiswa
                    </div>
                    <input type="number" id="detail-student-id" placeholder="Masukkan Student ID..." style="width: 100%; padding: 8px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testGetStudentDetail()">‚ñ∂Ô∏è Test</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student/:id')">üìã Copy</button>
                    </div>
                </div>

                <!-- Update Student -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge" style="background: #f39c12;">PUT</span>
                        Edit Mahasiswa
                    </h3>
                    <div class="endpoint">/api/billing/student/:id</div>
                    <div class="description">
                        Edit data mahasiswa yang sudah terdaftar
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="toggleEditStudentForm()">‚úèÔ∏è Edit Form</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student/:id')">üìã Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- BILLING SECTION -->
        <div class="category">
            <div class="category-title">
                <h2>üìã BILLING APIs</h2>
            </div>

            <div class="api-grid">
                <!-- Get Student Billing -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Lihat Tagihan Mahasiswa
                    </h3>
                    <p class="description">Dapatkan detail tagihan untuk seorang mahasiswa</p>
                    <div class="endpoint">/api/billing/student/&lt;student_id&gt;</div>
                    <div class="input-group">
                        <label>Student ID:</label>
                        <input type="number" id="get-billing-student-id" placeholder="Contoh: 1" value="1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testGetBilling()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/student/1')">Copy</button>
                    </div>
                </div>

                <!-- Check KRS Eligibility -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Cek Boleh Isi KRS
                    </h3>
                    <p class="description">Verifikasi mahasiswa boleh mendaftar KRS (tidak ada tunggakan)</p>
                    <div class="endpoint">/api/billing/can-register/&lt;student_id&gt;</div>
                    <div class="input-group">
                        <label>Student ID:</label>
                        <input type="number" id="can-register-student-id" placeholder="Contoh: 1" value="1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testCanRegister()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/can-register/1')">Copy</button>
                    </div>
                </div>

                <!-- Get Outstanding Billings -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Daftar Tagihan Outstanding
                    </h3>
                    <p class="description">Lihat semua tagihan yang belum lunas/sebagian lunas</p>
                    <div class="endpoint">/api/billing/outstanding</div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testOutstanding()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/billing/outstanding')">Copy</button>
                    </div>
                </div>

                <!-- Generate Billing -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-post">POST</span>
                        Generate Billing Semester
                    </h3>
                    <p class="description">üî• Generate tagihan untuk semua mahasiswa aktif di semester tertentu</p>
                    <div class="endpoint">/api/billing/generate/&lt;semester_id&gt;</div>
                    <div class="input-group">
                        <label>Semester ID (1, 2, 3, ...):</label>
                        <input type="number" id="generate-billing-semester-id" placeholder="Contoh: 1" value="1">
                        <small style="color: #666; display: block; margin-top: 5px;" id="semester-hint">üí° Masukkan ID semester (gunakan dropdown di bawah untuk lihat pilihan)</small>
                    </div>
                    <div class="input-group" style="display: none;" id="semester-list-group">
                        <label style="font-weight: bold;">üìã Semester Tersedia:</label>
                        <div id="semester-list-display" style="background: #f5f5f5; padding: 8px; border-radius: 5px; font-size: 0.9em;"></div>
                    </div>
                    <div class="input-group">
                        <label>Due Days (default: 14):</label>
                        <input type="number" id="generate-billing-due-days" placeholder="Hari sampai due date" value="14">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="generateBilling()">Generate üöÄ</button>
                        <button class="btn-secondary" onclick="toggleSemesterList()">üìã Lihat Daftar</button>
                    </div>
                    <div id="generate-billing-result" style="margin-top: 10px; display: none;"></div>
                </div>

                <!-- Delete Billing by ID -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge" style="background: #f44336;">DELETE</span>
                        Hapus Billing Tertentu
                    </h3>
                    <p class="description">üóëÔ∏è Hapus billing berdasarkan ID billing</p>
                    <div class="endpoint">/api/billing/&lt;billing_id&gt;</div>
                    <div class="input-group">
                        <label>Billing ID:</label>
                        <input type="number" id="delete-billing-id" placeholder="Contoh: 1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" style="background: #f44336;" onclick="deleteBilling()">Hapus üóëÔ∏è</button>
                    </div>
                    <div id="delete-billing-result" style="margin-top: 10px; display: none;"></div>
                </div>

                <!-- Delete All Billings for Student -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge" style="background: #ff9800;">DELETE</span>
                        Hapus Semua Billing Mahasiswa
                    </h3>
                    <p class="description">üóëÔ∏è Hapus semua billing untuk satu mahasiswa</p>
                    <div class="endpoint">/api/billing/student/&lt;student_id&gt;</div>
                    <div class="input-group">
                        <label>Student ID:</label>
                        <input type="number" id="delete-student-billing-id" placeholder="Contoh: 1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" style="background: #ff9800;" onclick="deleteStudentBillings()">Hapus Semua üóëÔ∏è</button>
                    </div>
                    <div id="delete-student-billing-result" style="margin-top: 10px; display: none;"></div>
                </div>

                <!-- Delete All Billings for Semester -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge" style="background: #9c27b0;">DELETE</span>
                        Hapus Semua Billing Semester
                    </h3>
                    <p class="description">üóëÔ∏è Hapus semua billing untuk satu semester</p>
                    <div class="endpoint">/api/billing/semester/&lt;semester_id&gt;</div>
                    <div class="input-group">
                        <label>Semester ID:</label>
                        <input type="number" id="delete-semester-billing-id" placeholder="Contoh: 1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" style="background: #9c27b0;" onclick="deleteSe–ºesterBillings()">Hapus Semua üóëÔ∏è</button>
                    </div>
                    <div id="delete-semester-billing-result" style="margin-top: 10px; display: none;"></div>
                </div>
            </div>
        </div>

        <!-- PAYMENT SECTION -->
        <div class="category">
            <div class="category-title">
                <h2>üí≥ PAYMENT APIs</h2>
            </div>

            <div class="api-grid">
                <!-- Payment History -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Riwayat Pembayaran
                    </h3>
                    <p class="description">Dapatkan history pembayaran mahasiswa</p>
                    <div class="endpoint">/api/payment/history/&lt;student_id&gt;</div>
                    <div class="input-group">
                        <label>Student ID:</label>
                        <input type="number" id="payment-history-student-id" placeholder="Contoh: 1" value="1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testPaymentHistory()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/payment/history/1')">Copy</button>
                    </div>
                </div>

                <!-- Payment Statistics -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Statistik Pembayaran
                    </h3>
                    <p class="description">Lihat statistik pembayaran secara keseluruhan</p>
                    <div class="endpoint">/api/payment/statistics</div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testPaymentStats()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/payment/statistics')">Copy</button>
                    </div>
                </div>

                <!-- Process Payment -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-post">POST</span>
                        Proses Pembayaran Manual
                    </h3>
                    <p class="description">Catat pembayaran SPP mahasiswa secara manual</p>
                    <div class="endpoint">/api/payment/process</div>
                    <div class="input-group">
                        <label>Billing ID:</label>
                        <input type="number" id="process-billing-id" placeholder="Contoh: 1" value="1">
                    </div>
                    <div class="input-group">
                        <label>Jumlah Bayar (Rp):</label>
                        <input type="number" id="process-amount" placeholder="Contoh: 5000000" value="5000000">
                    </div>
                    <div class="input-group">
                        <label>Payment Method ID:</label>
                        <input type="number" id="process-method" placeholder="Contoh: 1" value="1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testProcessPayment()">Test API</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- DASHBOARD SECTION -->
        <div class="category">
            <div class="category-title">
                <h2>üìä DASHBOARD APIs</h2>
            </div>

            <div class="api-grid">
                <!-- Dashboard Summary -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Ringkasan Dashboard
                    </h3>
                    <p class="description">Dapatkan ringkasan dashboard (quick stats)</p>
                    <div class="endpoint">/api/dashboard/summary</div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testDashboardSummary()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/dashboard/summary')">Copy</button>
                    </div>
                </div>

                <!-- Financial Report -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Laporan Keuangan (AI)
                    </h3>
                    <p class="description">Laporan keuangan dengan AI insights dan rekomendasi</p>
                    <div class="endpoint">/api/dashboard/financial-report?days=30</div>
                    <div class="input-group">
                        <label>Jumlah Hari:</label>
                        <input type="number" id="report-days" placeholder="Contoh: 30" value="30">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testFinancialReport()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/dashboard/financial-report?days=30')">Copy</button>
                    </div>
                </div>

                <!-- Program Studi Stats -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Statistik Per Prodi
                    </h3>
                    <p class="description">Lihat statistik pembayaran per program studi</p>
                    <div class="endpoint">/api/dashboard/program-studi-stats</div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testProgramStats()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/dashboard/program-studi-stats')">Copy</button>
                    </div>
                </div>

                <!-- Student Profile -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Profil Finansial Mahasiswa
                    </h3>
                    <p class="description">Dapatkan profil finansial lengkap satu mahasiswa</p>
                    <div class="endpoint">/api/dashboard/student-profile/&lt;student_id&gt;</div>
                    <div class="input-group">
                        <label>Student ID:</label>
                        <input type="number" id="profile-student-id" placeholder="Contoh: 1" value="1">
                    </div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testStudentProfile()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/dashboard/student-profile/1')">Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- WEBHOOK SECTION -->
        <div class="category">
            <div class="category-title">
                <h2>üîó WEBHOOK APIs</h2>
            </div>

            <div class="api-grid">
                <!-- Webhook Health -->
                <div class="api-card">
                    <h3>
                        <span class="method-badge method-get">GET</span>
                        Health Check
                    </h3>
                    <p class="description">Verifikasi webhook service berjalan</p>
                    <div class="endpoint">/api/webhook/health</div>
                    <div class="btn-group">
                        <button class="btn-primary" onclick="testWebhookHealth()">Test API</button>
                        <button class="btn-secondary" onclick="copyEndpoint('/api/webhook/health')">Copy</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>SPP Management System ¬© 2024 | API Documentation</p>
            <p>Baca lengkap: README.md | IMPLEMENTATION_GUIDE.md | PROJECT_SUMMARY.md</p>
        </div>
    </div>

    <!-- Student Management Forms -->
    
    <!-- Add Student Modal -->
    <div id="addStudentModal" class="response-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ûï Tambah Mahasiswa Baru</h2>
                <button class="close-btn" onclick="closeAddStudentForm()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <input type="text" id="add-nim" placeholder="NIM (Nomor Induk Mahasiswa)*" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <input type="text" id="add-name" placeholder="Nama Lengkap*" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <input type="email" id="add-email" placeholder="Email*" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <input type="tel" id="add-phone" placeholder="No. Telepon" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <select id="add-program" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">-- Pilih Program Studi* --</option>
                    <option value="1">Teknik Informatika</option>
                    <option value="2">Ekonomi</option>
                    <option value="3">Hukum</option>
                    <option value="4">Pendidikan</option>
                </select>
                <select id="add-status" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="active">Aktif</option>
                    <option value="inactive">Tidak Aktif</option>
                    <option value="graduated">Lulus</option>
                </select>
                <div id="addStudentResponse" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; display: none;"></div>
                <button class="btn-primary" onclick="submitAddStudent()" style="width: 100%; padding: 12px; margin-top: 10px;">‚úÖ Tambah Mahasiswa</button>
            </div>
        </div>
    </div>

    <!-- Delete Student Modal -->
    <div id="deleteStudentModal" class="response-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üóëÔ∏è Hapus Mahasiswa</h2>
                <button class="close-btn" onclick="closeDeleteStudentForm()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <input type="number" id="delete-id" placeholder="Masukkan Student ID..." style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <div id="deleteStudentResponse" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; display: none;"></div>
                <button class="btn-primary" onclick="submitDeleteStudent()" style="width: 100%; padding: 12px; margin-top: 10px; background: #e74c3c;">üóëÔ∏è Hapus</button>
            </div>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="response-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚úèÔ∏è Edit Mahasiswa</h2>
                <button class="close-btn" onclick="closeEditStudentForm()">&times;</button>
            </div>
            <div style="padding: 20px;">
                <input type="number" id="edit-id" placeholder="Student ID*" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <input type="text" id="edit-name" placeholder="Nama Baru (Optional)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <input type="email" id="edit-email" placeholder="Email Baru (Optional)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <input type="tel" id="edit-phone" placeholder="No. Telepon (Optional)" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <select id="edit-status" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="">-- Pilih Status (Optional) --</option>
                    <option value="active">Aktif</option>
                    <option value="inactive">Tidak Aktif</option>
                    <option value="graduated">Lulus</option>
                </select>
                <div id="editStudentResponse" style="background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 4px; display: none;"></div>
                <button class="btn-primary" onclick="submitEditStudent()" style="width: 100%; padding: 12px; margin-top: 10px; background: #f39c12;">‚úèÔ∏è Update</button>
            </div>
        </div>
    </div>

    <!-- Response Modal -->
    <div id="responseModal" class="response-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>API Response</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Loading...</p>
            </div>
            <div class="response-content" id="responseContent"></div>
        </div>
    </div>

    <script>
        // ============================================================
        // STUDENT MANAGEMENT FUNCTIONS
        // ============================================================
        
        function toggleAddStudentForm() {
            document.getElementById('addStudentModal').style.display = 'block';
            document.getElementById('addStudentResponse').style.display = 'none';
        }
        
        function closeAddStudentForm() {
            document.getElementById('addStudentModal').style.display = 'none';
        }
        
        function submitAddStudent() {
            const nim = document.getElementById('add-nim').value;
            const name = document.getElementById('add-name').value;
            const email = document.getElementById('add-email').value;
            const phone = document.getElementById('add-phone').value;
            const program_studi_id = document.getElementById('add-program').value;
            const status = document.getElementById('add-status').value;
            
            if (!nim || !name || !email || !program_studi_id) {
                alert('‚ö†Ô∏è NIM, Nama, Email, dan Program Studi harus diisi!');
                return;
            }
            
            const payload = {
                nim: nim,
                name: name,
                email: email,
                phone: phone,
                program_studi_id: parseInt(program_studi_id),
                status: status
            };
            
            fetch(window.location.origin + '/api/billing/student', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(d => {
                const respDiv = document.getElementById('addStudentResponse');
                respDiv.style.display = 'block';
                respDiv.innerHTML = '<pre style="color: #155724; margin: 0;">' + JSON.stringify(d, null, 2) + '</pre>';
                if (d.message || d.success) {
                    // Reset form
                    document.getElementById('add-nim').value = '';
                    document.getElementById('add-name').value = '';
                    document.getElementById('add-email').value = '';
                    document.getElementById('add-phone').value = '';
                    document.getElementById('add-program').value = '';
                    document.getElementById('add-status').value = 'active';
                }
            })
            .catch(e => {
                const respDiv = document.getElementById('addStudentResponse');
                respDiv.style.display = 'block';
                respDiv.innerHTML = '<pre style="color: #721c24; margin: 0;">‚ùå Error: ' + e.message + '</pre>';
            });
        }
        
        function toggleDeleteStudentForm() {
            document.getElementById('deleteStudentModal').style.display = 'block';
            document.getElementById('deleteStudentResponse').style.display = 'none';
        }
        
        function closeDeleteStudentForm() {
            document.getElementById('deleteStudentModal').style.display = 'none';
        }
        
        function submitDeleteStudent() {
            const id = document.getElementById('delete-id').value;
            
            if (!id) {
                alert('‚ö†Ô∏è Student ID harus diisi!');
                return;
            }
            
            if (!confirm('‚ö†Ô∏è Apakah Anda yakin ingin menghapus mahasiswa ini?')) {
                return;
            }
            
            fetch(window.location.origin + '/api/billing/student/' + id, {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' }
            })
            .then(r => r.json())
            .then(d => {
                const respDiv = document.getElementById('deleteStudentResponse');
                respDiv.style.display = 'block';
                respDiv.innerHTML = '<pre style="color: #155724; margin: 0;">' + JSON.stringify(d, null, 2) + '</pre>';
                if (d.message) {
                    document.getElementById('delete-id').value = '';
                }
            })
            .catch(e => {
                const respDiv = document.getElementById('deleteStudentResponse');
                respDiv.style.display = 'block';
                respDiv.innerHTML = '<pre style="color: #721c24; margin: 0;">‚ùå Error: ' + e.message + '</pre>';
            });
        }
        
        function toggleEditStudentForm() {
            document.getElementById('editStudentModal').style.display = 'block';
            document.getElementById('editStudentResponse').style.display = 'none';
        }
        
        function closeEditStudentForm() {
            document.getElementById('editStudentModal').style.display = 'none';
        }
        
        function submitEditStudent() {
            const id = document.getElementById('edit-id').value;
            const name = document.getElementById('edit-name').value;
            const email = document.getElementById('edit-email').value;
            const phone = document.getElementById('edit-phone').value;
            const status = document.getElementById('edit-status').value;
            
            if (!id) {
                alert('‚ö†Ô∏è Student ID harus diisi!');
                return;
            }
            
            const payload = {};
            if (name) payload.name = name;
            if (email) payload.email = email;
            if (phone) payload.phone = phone;
            if (status) payload.status = status;
            
            fetch(window.location.origin + '/api/billing/student/' + id, {
                method: 'PUT',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(d => {
                const respDiv = document.getElementById('editStudentResponse');
                respDiv.style.display = 'block';
                respDiv.innerHTML = '<pre style="color: #155724; margin: 0;">' + JSON.stringify(d, null, 2) + '</pre>';
                if (d.message) {
                    document.getElementById('edit-id').value = '';
                    document.getElementById('edit-name').value = '';
                    document.getElementById('edit-email').value = '';
                    document.getElementById('edit-phone').value = '';
                    document.getElementById('edit-status').value = '';
                }
            })
            .catch(e => {
                const respDiv = document.getElementById('editStudentResponse');
                respDiv.style.display = 'block';
                respDiv.innerHTML = '<pre style="color: #721c24; margin: 0;">‚ùå Error: ' + e.message + '</pre>';
            });
        }
        
        function testSearchStudent() {
            const query = document.getElementById('search-student-query').value;
            if (!query || query.length < 2) {
                alert('‚ö†Ô∏è Query minimal 2 karakter!');
                return;
            }
            showModal('/api/billing/student/search?q=' + query);
        }
        
        function testGetStudentDetail() {
            const id = document.getElementById('detail-student-id').value;
            if (!id) {
                alert('‚ö†Ô∏è Student ID harus diisi!');
                return;
            }
            showModal('/api/billing/student/' + id);
        }

        // ============================================================
        // EXISTING FUNCTIONS
        // ============================================================
        
        function showModal(endpoint, method = 'GET') {
            document.getElementById('responseModal').style.display = 'block';
            document.getElementById('loading').classList.add('show');
            document.getElementById('responseContent').textContent = '';
            
            const baseUrl = window.location.origin;
            const fullUrl = baseUrl + endpoint;
            
            fetch(fullUrl, { method })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('loading').classList.remove('show');
                    document.getElementById('responseContent').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('loading').classList.remove('show');
                    document.getElementById('responseContent').innerHTML = 
                        '<div class="error-text">‚ùå Error: ' + error.message + '</div>';
                });
        }

        function closeModal() {
            document.getElementById('responseModal').style.display = 'none';
        }

        function copyEndpoint(endpoint) {
            const text = window.location.origin + endpoint;
            navigator.clipboard.writeText(text).then(() => {
                alert('‚úÖ Endpoint copied: ' + text);
            });
        }

        function testGetBilling() {
            const studentId = document.getElementById('get-billing-student-id').value;
            showModal(`/api/billing/student/${studentId}`);
        }

        function testCanRegister() {
            const studentId = document.getElementById('can-register-student-id').value;
            showModal(`/api/billing/can-register/${studentId}`);
        }

        function testOutstanding() {
            showModal('/api/billing/outstanding');
        }

        function testPaymentHistory() {
            const studentId = document.getElementById('payment-history-student-id').value;
            showModal(`/api/payment/history/${studentId}`);
        }

        function testPaymentStats() {
            showModal('/api/payment/statistics');
        }

        function testProcessPayment() {
            const billingId = document.getElementById('process-billing-id').value;
            const amount = document.getElementById('process-amount').value;
            const methodId = document.getElementById('process-method').value;
            
            const payload = {
                billing_id: parseInt(billingId),
                amount: parseInt(amount),
                payment_method_id: parseInt(methodId),
                transaction_id: 'TXN-' + Date.now()
            };
            
            document.getElementById('responseModal').style.display = 'block';
            document.getElementById('loading').classList.add('show');
            
            fetch(window.location.origin + '/api/payment/process', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(d => {
                document.getElementById('loading').classList.remove('show');
                document.getElementById('responseContent').textContent = JSON.stringify(d, null, 2);
            })
            .catch(e => {
                document.getElementById('loading').classList.remove('show');
                document.getElementById('responseContent').innerHTML = '<div class="error-text">‚ùå Error: ' + e.message + '</div>';
            });
        }

        function testDashboardSummary() {
            showModal('/api/dashboard/summary');
        }

        function testFinancialReport() {
            const days = document.getElementById('report-days').value;
            showModal(`/api/dashboard/financial-report?days=${days}`);
        }

        function testProgramStats() {
            showModal('/api/dashboard/program-studi-stats');
        }

        function testStudentProfile() {
            const studentId = document.getElementById('profile-student-id').value;
            showModal(`/api/dashboard/student-profile/${studentId}`);
        }

        function testWebhookHealth() {
            showModal('/api/webhook/health');
        }

        function loadSemesters() {
            fetch(window.location.origin + '/api/billing/semesters')
                .then(r => r.json())
                .then(data => {
                    const hint = document.getElementById('semester-hint');
                    const listGroup = document.getElementById('semester-list-group');
                    const listDisplay = document.getElementById('semester-list-display');
                    
                    if (!data.semesters || data.semesters.length === 0) {
                        hint.textContent = '‚ö†Ô∏è Belum ada semester di database';
                        listDisplay.innerHTML = '<p style="color: #c62828;">Belum ada semester. Gunakan setup_semester.py untuk membuat.</p>';
                        return;
                    }
                    
                    // Build semester list display
                    let listHtml = '';
                    data.semesters.forEach(s => {
                        const status = s.is_active ? 'üü¢ ACTIVE' : '‚ö´';
                        const generated = s.billing_generation_date ? '‚úÖ Generated' : '‚è≥ Not generated';
                        listHtml += `<div style="padding: 5px 0; border-bottom: 1px solid #ddd;">
                            <strong>ID ${s.id}</strong>: ${s.name} ${status} - ${generated}
                        </div>`;
                    });
                    
                    listDisplay.innerHTML = listHtml;
                    hint.textContent = `‚úÖ Ada ${data.semesters.length} semester (klik "üìã Lihat Daftar" untuk melihat pilihan)`;
                })
                .catch(e => {
                    console.log('Error loading semesters:', e);
                    document.getElementById('semester-hint').textContent = '‚ùå Error loading semesters';
                });
        }

        function toggleSemesterList() {
            const group = document.getElementById('semester-list-group');
            group.style.display = group.style.display === 'none' ? 'block' : 'none';
        }

        function generateBilling() {
            const semesterId = document.getElementById('generate-billing-semester-id').value;
            const dueDays = document.getElementById('generate-billing-due-days').value || 14;
            
            if (!semesterId) {
                alert('Masukkan Semester ID');
                return;
            }
            
            const resultDiv = document.getElementById('generate-billing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p style="color: #2196F3;">‚è≥ Sedang generate billing untuk semester ID ' + semesterId + '...</p>';
            
            const payload = {
                due_days: parseInt(dueDays)
            };
            
            fetch(window.location.origin + `/api/billing/generate/${semesterId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(payload)
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; border-left: 4px solid #4CAF50;">
                            <p style="color: #2e7d32; font-weight: bold;">‚úÖ ${data.message}</p>
                            <p style="color: #555; margin-top: 5px;">
                                üìä Created: ${data.created_count} | Failed: ${data.failed_count}
                            </p>
                        </div>
                    `;
                } else {
                    let errorHtml = `
                        <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                            <p style="color: #c62828; font-weight: bold;">‚ùå ${data.message}</p>
                    `;
                    
                    if (data.available_semesters && data.available_semesters.length > 0) {
                        errorHtml += `<p style="color: #666; margin-top: 8px;"><strong>Semester tersedia:</strong></p><ul style="margin-top: 5px; margin-left: 20px;">`;
                        data.available_semesters.forEach(s => {
                            const status = s.is_active ? 'üü¢' : '‚ö´';
                            errorHtml += `<li>${status} ID <strong>${s.id}</strong>: ${s.name}</li>`;
                        });
                        errorHtml += `</ul>`;
                    } else if (data.hint) {
                        errorHtml += `<p style="color: #666; margin-top: 8px;">üí° ${data.hint}</p>`;
                    }
                    
                    errorHtml += `</div>`;
                    resultDiv.innerHTML = errorHtml;
                }
            })
            .catch(e => {
                resultDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                        <p style="color: #c62828; font-weight: bold;">‚ùå Error: ${e.message}</p>
                    </div>
                `;
            });
        }


        function deleteBilling() {
            const billingId = document.getElementById('delete-billing-id').value;
            
            if (!billingId) {
                alert('Masukkan Billing ID');
                return;
            }
            
            if (!confirm(`Yakin ingin menghapus Billing ID ${billingId}?`)) {
                return;
            }
            
            const resultDiv = document.getElementById('delete-billing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p style="color: #2196F3;">‚è≥ Sedang menghapus billing...</p>';
            
            fetch(window.location.origin + `/api/billing/${billingId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; border-left: 4px solid #4CAF50;">
                            <p style="color: #2e7d32; font-weight: bold;">‚úÖ ${data.message}</p>
                            <p style="color: #555; margin-top: 5px;">
                                üí∞ Amount: Rp ${(data.deleted_billing.total_amount || 0).toLocaleString('id-ID')}
                            </p>
                        </div>
                    `;
                    document.getElementById('delete-billing-id').value = '';
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                            <p style="color: #c62828; font-weight: bold;">‚ùå ${data.message}</p>
                        </div>
                    `;
                }
            })
            .catch(e => {
                resultDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                        <p style="color: #c62828; font-weight: bold;">‚ùå Error: ${e.message}</p>
                    </div>
                `;
            });
        }

        function deleteStudentBillings() {
            const studentId = document.getElementById('delete-student-billing-id').value;
            
            if (!studentId) {
                alert('Masukkan Student ID');
                return;
            }
            
            if (!confirm(`Yakin ingin menghapus SEMUA billing untuk Student ID ${studentId}?`)) {
                return;
            }
            
            const resultDiv = document.getElementById('delete-student-billing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p style="color: #2196F3;">‚è≥ Sedang menghapus billing...</p>';
            
            fetch(window.location.origin + `/api/billing/student/${studentId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; border-left: 4px solid #4CAF50;">
                            <p style="color: #2e7d32; font-weight: bold;">‚úÖ ${data.message}</p>
                            <p style="color: #555; margin-top: 5px;">
                                üìä Deleted: ${data.deleted_count} billing
                            </p>
                        </div>
                    `;
                    document.getElementById('delete-student-billing-id').value = '';
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                            <p style="color: #c62828; font-weight: bold;">‚ùå ${data.message}</p>
                        </div>
                    `;
                }
            })
            .catch(e => {
                resultDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                        <p style="color: #c62828; font-weight: bold;">‚ùå Error: ${e.message}</p>
                    </div>
                `;
            });
        }

        function deleteSe–ºesterBillings() {
            const semesterId = document.getElementById('delete-semester-billing-id').value;
            
            if (!semesterId) {
                alert('Masukkan Semester ID');
                return;
            }
            
            if (!confirm(`Yakin ingin menghapus SEMUA billing untuk Semester ID ${semesterId}?`)) {
                return;
            }
            
            const resultDiv = document.getElementById('delete-semester-billing-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p style="color: #2196F3;">‚è≥ Sedang menghapus billing...</p>';
            
            fetch(window.location.origin + `/api/billing/semester/${semesterId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(r => r.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div style="background: #e8f5e9; padding: 10px; border-radius: 5px; border-left: 4px solid #4CAF50;">
                            <p style="color: #2e7d32; font-weight: bold;">‚úÖ ${data.message}</p>
                            <p style="color: #555; margin-top: 5px;">
                                üìä Deleted: ${data.deleted_count} billing
                            </p>
                        </div>
                    `;
                    document.getElementById('delete-semester-billing-id').value = '';
                } else {
                    resultDiv.innerHTML = `
                        <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                            <p style="color: #c62828; font-weight: bold;">‚ùå ${data.message}</p>
                        </div>
                    `;
                }
            })
            .catch(e => {
                resultDiv.innerHTML = `
                    <div style="background: #ffebee; padding: 10px; border-radius: 5px; border-left: 4px solid #f44336;">
                        <p style="color: #c62828; font-weight: bold;">‚ùå Error: ${e.message}</p>
                    </div>
                `;
            });
        }

        // Load initial stats
        function loadStats() {
            fetch(window.location.origin + '/api/dashboard/summary')
                .then(r => r.json())
                .then(d => {
                    if (d.metrics) {
                        document.getElementById('total-students').textContent = d.metrics.total_active_students || '-';
                        document.getElementById('total-billed').textContent = 
                            'Rp ' + (d.metrics.total_billed || 0).toLocaleString('id-ID');
                        document.getElementById('total-paid').textContent = 
                            'Rp ' + (d.metrics.total_paid || 0).toLocaleString('id-ID');
                        document.getElementById('collection-rate').textContent = 
                            (d.metrics.collection_rate || 0) + '%';
                    }
                })
                .catch(e => console.log('Stats load error:', e));
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('responseModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }

        // Load stats and semesters on page load
        window.addEventListener('load', function() {
            loadStats();
            loadSemesters();
        });
    </script>
</body>
</html>
